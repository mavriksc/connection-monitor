<!DOCTYPE html>
<html>
<head>
    <title>Connection tester</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<div id="graph"></div>
<script src="/socket.io/socket.io.js"></script>

<script>
  const socket = io();
  const colors = ['#80CAF6', '#DF56F1', '#66f156'];
  let hs;

  function createPlot(hosts) {
    const data = [];
    hs.forEach(host => {
      const color = colors[hosts.indexOf(host)]
      const time = new Date();
      const traceData = {
        x: [time],
        y: [0],
        name: host,
        mode: 'lines',
        line: {
          color: color,
        }
      }
      data.push(traceData);
    });
    Plotly.plot('graph', data);
  }

  function updatePlot(host, msg) {
    const time = new Date();
    const update = {
      x: [[time]],
      y: [[msg]]
    };
    Plotly.extendTraces('graph', update, [hs.indexOf(host)])

  }

  socket.on('hosts', function (hosts) {
    hs = hosts;
    createPlot(hosts)
    hs.forEach(function (host) {
      console.log(host);
      socket.on(host, function (msg) {
        updatePlot(host, msg)
      });
    });
  });


</script>
</body>
</html>
